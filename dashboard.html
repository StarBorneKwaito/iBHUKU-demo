<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iBHUKU | Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="stock-in.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dashboard-page">
    <header class="app-header">
        <div class="branding">
            <i class="fas fa-book"></i>
            <span>iBHUKU Inventory</span>
        </div>
        <div class="user-controls">
            <span class="username">Admin User</span>
            <i class="fas fa-user-circle"></i>
        </div>
    </header>
    <div class="app-body">
        <nav class="app-sidebar">
            <ul class="nav-menu">
                <li class="active"><a href="#"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="stock-in.html"><i class="fas fa-sign-in-alt"></i> Stock In</a></li>
                <li><a href="stock-out.html"><i class="fas fa-sign-out-alt"></i> Stock Out</a></li>
                <li><a href="inventory.html"><i class="fas fa-boxes"></i> Inventory</a></li>
                <li><a href="report.html"><i class="fas fa-chart-line"></i> Reports</a></li>
                <li><a href="help.html"><i class="fas fa-question-circle"></i> Help</a></li>
                <li><a href="logout.html"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>
        <main class="app-main">
            <div class="page-header">
                <h1 class="page-title">Dashboard Overview</h1>
                <div class="report-controls">
                    <select class="time-period">
                        <option>Today</option>
                        <option selected>This Week</option>
                        <option>This Month</option>
                        <option>This Quarter</option>
                        <option>This Year</option>
                    </select>
                </div>
            </div>
            <div class="card summary-card">
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value">24</div>
                        <div class="stat-label">Stock In Today</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> 12% from yesterday
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">18</div>
                        <div class="stat-label">Stock Out Today</div>
                        <div class="card-change negative">
                            <i class="fas fa-arrow-down"></i> 5% from yesterday
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">1,248</div>
                        <div class="stat-label">Total Inventory Items</div>
                        <div class="card-change neutral">
                            <i class="fas fa-minus"></i> No change
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">23</div>
                        <div class="stat-label">Low Stock Items</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-down"></i> 8% from last week
                        </div>
                    </div>
                </div>
            </div>
            <div class="dashboard-row">
                <!-- SITES CARD (large) -->
                <div class="dashboard-card large sites-widget">
                    <div class="card-header">
                        <h2>Sites</h2>
                    </div>
                    <div class="sites-list">
                        <div class="site-card" style="background: linear-gradient(120deg, #ffe9a7 60%, #fffbe6 100%);">
                            <div class="site-icon vibrant"><i class="fas fa-house"></i></div>
                            <div class="site-info">
                                <div class="site-name">ME Ext 03</div>
                                <div class="site-meta">Active • 12 items</div>
                            </div>
                            <button class="site-action"><i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div class="site-card" style="background: linear-gradient(120deg, #e2f7fa 60%, #f8fdff 100%);">
                            <div class="site-icon vibrant" style="background: #3498db1a; color: #3498db;"><i class="fas fa-house"></i></div>
                            <div class="site-info">
                                <div class="site-name">ME Ext 6&6</div>
                                <div class="site-meta">Active • 8 items</div>
                            </div>
                            <button class="site-action"><i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div class="site-card" style="background: linear-gradient(120deg, #eafbe7 60%, #f8fff6 100%);">
                            <div class="site-icon vibrant" style="background: #2ecc711a; color: #2ecc71;"><i class="fas fa-house"></i></div>
                            <div class="site-info">
                                <div class="site-name">ME Ext 10a</div>
                                <div class="site-meta">Inactive • 0 items</div>
                            </div>
                            <button class="site-action"><i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div class="site-card" style="background: linear-gradient(120deg, #fbe7e7 60%, #fff6f6 100%);">
                            <div class="site-icon vibrant" style="background: #e74c3c1a; color: #e74c3c;"><i class="fas fa-house"></i></div>
                            <div class="site-info">
                                <div class="site-name">ME Ext 10b</div>
                                <div class="site-meta">Active • 5 items</div>
                            </div>
                            <button class="site-action"><i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div class="site-card" style="background: linear-gradient(120deg, #f3e7fb 60%, #f9f6ff 100%);">
                            <div class="site-icon vibrant" style="background: #9b59b61a; color: #9b59b6;"><i class="fas fa-house"></i></div>
                            <div class="site-info">
                                <div class="site-name">ME Ext 10c</div>
                                <div class="site-meta">Active • 7 items</div>
                            </div>
                            <button class="site-action"><i class="fas fa-arrow-right"></i></button>
                        </div>
                        <div class="site-card add-site" style="background: linear-gradient(120deg, #fffbe6 60%, #ffe9a7 100%);">
                            <button class="site-icon vibrant" style="background: #fffbe6; color: #D4AF37;"><i class="fas fa-plus"></i></button>
                            <div class="site-info">
                                <div class="site-name">Add Site</div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- WEATHER WIDGET CARD (replaces Stock Movement) -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Live Weather</h2>
                    </div>
                    <div style="height:300px; display:flex; align-items:center; justify-content:center; flex-direction:column;">
                        <iframe 
                            src="https://www.google.com/search?q=weather+pretoria"
                            style="width:100%; min-width:220px; height:260px; border:0; border-radius:12px; box-shadow:0 2px 8px rgba(44,62,80,0.05);"
                            loading="lazy"
                            title="Google Weather"
                        ></iframe>
                        <a href="https://www.google.com/search?q=weather+pretoria" target="_blank" style="margin-top:8px; color:var(--primary); text-decoration:none; font-size:0.95rem;">
                            View full weather on Google
                        </a>
                    </div>
                    <!-- Location Widget -->
                    <div style="margin-top: 1.5rem; display: flex; flex-direction: column; align-items: center;">
                        <h3 style="font-size:1.1rem; color:var(--primary-dark); margin-bottom:0.5rem;">
                            <i class="fas fa-map-marker-alt" style="color:var(--primary);"></i> Your Location
                        </h3>
                        <div id="location-info" style="font-size:0.98rem; color:var(--secondary-lighter); text-align:center;">
                            Detecting location...
                        </div>
                        <!-- Map Widget -->
                        <div id="location-map-container" style="width:100%; max-width:340px; height:180px; margin-top:1rem; border-radius:12px; overflow:hidden; box-shadow:0 2px 8px rgba(44,62,80,0.08); background:#eee;">
                            <iframe
                                id="location-map"
                                width="100%"
                                height="180"
                                frameborder="0"
                                style="border:0; width:100%; height:100%;"
                                src=""
                                allowfullscreen=""
                                aria-hidden="false"
                                tabindex="0"
                                title="Your Location Map"
                            ></iframe>
                        </div>
                    </div>
                </div>
                <!-- INVENTORY BY CATEGORY CARD -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Inventory by Category</h2>
                    </div>
                    <div class="chart-container" style="height:300px;">
                        <canvas id="inventoryCategoryChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="dashboard-row">
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Recent Activity</h2>
                        <a href="#" class="btn-link">View All</a>
                    </div>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">New stock received</div>
                                <div class="activity-details">50 bags of cement added</div>
                                <div class="activity-time">10:45 AM</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Stock issued</div>
                                <div class="activity-details">25 roofing sheets to Site A</div>
                                <div class="activity-time">09:30 AM</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Low stock alert</div>
                                <div class="activity-details">Power Bank 10000mAh (3 remaining)</div>
                                <div class="activity-time">Yesterday</div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">New user added</div>
                                <div class="activity-details">Site Manager - John Doe</div>
                                <div class="activity-time">Yesterday</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Quick Actions</h2>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-action">
                            <i class="fas fa-plus-circle"></i>
                            <span>Add New Stock</span>
                        </button>
                        <button class="quick-action">
                            <i class="fas fa-file-export"></i>
                            <span>Generate Report</span>
                        </button>
                        <button class="quick-action">
                            <i class="fas fa-bell"></i>
                            <span>Set Alerts</span>
                        </button>
                        <button class="quick-action">
                            <i class="fas fa-user-plus"></i>
                            <span>Add User</span>
                        </button>
                        <button class="quick-action">
                            <i class="fas fa-cog"></i>
                            <span>System Settings</span>
                        </button>
                        <button class="quick-action">
                            <i class="fas fa-question-circle"></i>
                            <span>Get Help</span>
                        </button>
                    </div>
                </div>
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Top Items</h2>
                        <a href="#" class="btn-link">View All</a>
                    </div>
                    <div class="top-items">
                        <div class="top-item">
                            <div class="item-rank">1</div>
                            <div class="item-name">Cement (50kg)</div>
                            <div class="item-value">R 85.00</div>
                        </div>
                        <div class="top-item">
                            <div class="item-rank">2</div>
                            <div class="item-name">Roofing Sheets</div>
                            <div class="item-value">R 320.00</div>
                        </div>
                        <div class="top-item">
                            <div class="item-rank">3</div>
                            <div class="item-name">Bricks (Standard)</div>
                            <div class="item-value">R 3.50</div>
                        </div>
                        <div class="top-item">
                            <div class="item-rank">4</div>
                            <div class="item-name">PVC Pipes (50mm)</div>
                            <div class="item-value">R 145.00</div>
                        </div>
                        <div class="top-item">
                            <div class="item-rank">5</div>
                            <div class="item-name">Power Bank 10000mAh</div>
                            <div class="item-value">R 299.00</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script>
        // Stock Movement Chart
        const stockMovementCtx = document.getElementById('stockMovementChart').getContext('2d');
        const stockMovementChart = new Chart(stockMovementCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [
                    {
                        label: 'Stock In',
                        data: [12, 19, 15, 22, 18, 14, 8],
                        borderColor: '#2ECC71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Stock Out',
                        data: [8, 12, 10, 16, 14, 10, 5],
                        borderColor: '#E74C3C',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Inventory Category Chart
        const inventoryCategoryCtx = document.getElementById('inventoryCategoryChart').getContext('2d');
        const inventoryCategoryChart = new Chart(inventoryCategoryCtx, {
            type: 'doughnut',
            data: {
                labels: ['Building', 'Electrical', 'Plumbing', 'Hardware', 'Safety'],
                datasets: [{
                    data: [420, 210, 180, 150, 120],
                    backgroundColor: [
                        '#D4AF37',
                        '#3498DB',
                        '#2ECC71',
                        '#E74C3C',
                        '#9B59B6'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });
    </script>
    <!-- Place this script just before </body> -->
    <script>
        // WeatherWidget.io loader
        !function(d,s,id){
            var js,fjs=d.getElementsByTagName(s)[0];
            if(!d.getElementById(id)){
                js=d.createElement(s);js.id=id;
                js.src='https://weatherwidget.io/js/widget.min.js';
                fjs.parentNode.insertBefore(js,fjs);
            }
        }(document,'script','weatherwidget-io-js');
    </script>
    <script>
        // Location Widget Script
        window.addEventListener('DOMContentLoaded', function() {
            var locInfo = document.getElementById('location-info');
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude.toFixed(4);
                    const lon = position.coords.longitude.toFixed(4);
                    // Reverse geocode using OpenStreetMap Nominatim
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
                        .then(res => res.json())
                        .then(data => {
                            let city = data.address.city || data.address.town || data.address.village || '';
                            let suburb = data.address.suburb || '';
                            let country = data.address.country || '';
                            let display = [suburb, city, country].filter(Boolean).join(', ');
                            locInfo.innerHTML = display
                                ? `<strong>${display}</strong><br><span style="font-size:0.93em;color:var(--secondary-light);">(${lat}, ${lon})</span>`
                                : `Lat: ${lat}, Lon: ${lon}`;
                        })
                        .catch(() => {
                            locInfo.textContent = `Lat: ${lat}, Lon: ${lon}`;
                        });
                }, function() {
                    locInfo.textContent = "Location access denied.";
                });
            } else {
                locInfo.textContent = "Geolocation not supported.";
            }
        });
    </script>
</body>
</html>